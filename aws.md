## 参考
- [AWSの基本・仕組み・重要用語が全部わかる教科書]()
- [AWSによるクラウド入門](https://tomomano.gitlab.io/intro-aws)


## 第1章　クラウドの基礎知識
- DBサーバとストレージが別で必要なのはなぜ？
  - 性能：APサーバとDBサーバとのやりとりは高速である必要があるが、高速なストレージは高価。ストレージを分離することにより、DBサーバは低コスト化できる
  - 拡張性：DBサーバの拡張は簡単ではないが、分離されたストレージ容量の拡張は簡単
  - 可用性：DBサーバがダウンしてもストレージは独立して動作し続けられる。ストレージを冗長化することで故障対策にも。
  - セキュリティ：アクセス権限を細かく制御可能。DBサーバのみのするとか、ストレージへのアクセスでもどのデータまでOKかとか。

- Software-defined Networking：ネットワーク全体を一元的に管理するコントローラーが存在。ネットワークをより柔軟かつ効率的に管理するための技術であり、ネットワークを使う人たちにとっては、よりスムーズな通信やデータ共有が可能に。

- Application Service Provider: Saasを提供するベンダ。例）勤怠管理ができるMoney Forward

- Service Oriented Architecture: ビジネス機能を分割し、それぞれの機能をサービスとして定義することで、システムの柔軟性や再利用性、相互運用性を高めることを目的としたアプリケーションの設計手法

## 第2章 AWSの基本と全体像
- リージョンには、複数のアベイラビリティゾーン(Az)とトランジットがある
  - Az：多数のサーバからなる１つ以上のデータセンタ
  - トランジット：Azから他のAWSリージョンや企業のオンプレミス環境、インターネットへの接続を経由
  - 👉 被災・障害・セキュリティ対策をしてくれているので安心◎

- リージョンに加えて、エッジロケーション・リージョナルエッジキャッシュが存在
  - 目的：エンドユーザからのアクセス速度の向上
  - CloudFrontなどのコンテンツ配信ネットワーク（CDN）サービスを利用した際に、物理的な場所に応じて最速で接続可能なデータセンタに配置されたサーバにアクセスされる
  - 👉 アクセス速度◎

- データベースとストレージの違い
  - データの構造化：データベースはデータ構造を定義してテーブルの形式で保存できるため、複雑なクエリを使用してデータ取得可能。ストレージはファイル形式でデータ保存。
  - データのアクセス方法：データベースはSQLを使用して検索・操作可能。ストレージはプログラムやアプリケーションから直接アクセス可能。
  - データの整合性：データベースはACIDの原則に従ってデータの整合性を保つ。ストレージは整合性を保証しない。
  - スケーラビリティ：データベースは大量のデータを効率的に処理可能（with クエリ最適化・インデックス作成）。ストレージは単純な読み書きに特化しているため大量のデータを処理する場合にはストレージの性能がボトルネックになる可能性。

- AWSを使う
  - AWSは各サービスでAPIを公開している。ユーザーはAPIを実行してクラウド環境や各サービスを利用できる
  - API実行方法
    - AWS Management Console (GUI)
    - AWS CLI
    - AWS SDK: Rubyなどのアプリケーションから利用されることを想定 
  - アプリケーション開発者用ユーザーの認証情報：アクセスキーとシークレットアクセスキー
  - SLA(Service Level Agreement): クラウド提供事業者が保証するサービス品質基準に関する合意。
    - AWSのユーザー企業が顧客向けにWebサービスを提供する際に、非機能要件（セキュリティや可用性など）をクラウドベンダ（AWS）とどのような役割分担で満たすのか
    - 顧客と契約したサービス提供レベルが維持できないような障害やセキュリティインシデントが発生した場合に、その責任や対応範囲は誰がどのように担うのか
    - 責任共有モデル：AWSとAWSユーザー企業との責任境界の目安

## 第3章 ネットワーク関連のサービス
### Amazon VPC
- Virtual Private Cloud
- AWS内に仮想ネットワークを構築できるサービス
- サーバやデータベースなどで構成されるシステムのためのネットワークを、オンデマンドで迅速に構築できる
- 仮想化されたネットワークにより、さまざまなロケーションに分散しているサーバや仮想マシンイメージが、あたかも１つの場所に集中して存在しているように扱える
- VPCは複数のAzをまたいで構築できるが、サブネットは各Azごとに作成する必要がある
- VPC内のアドレスはCIDRが「/16」~「/28」の間で使用できる。ただし、各サブネットの最初の４アドレス、最後の１アドレスは予約されているため使用できない

- サブネットはパブリックサブネットとプライベートサブネットがある
  - パブリックサブネット（緑）: 外部との接続を想定。デフォルトでトラフィックを外部に送信できる。
  - プライベートサブネット（青）: リソースやデータを外部アクセスから保護する用途を想定。デフォルトでトラフィックを外部に送信できない。

- VPC内のリソースが外部通信する際は、ネットワークゲートウェイリソース（VPC外のネットワークと通信を行う際に経由する中継地点）を設置する
  - Internet GateWay: VPCとインターネットの通信用途で設置。通信元のリソースがパブリックIPアドレスを持っている必要がある。固定的に割り当てられるパブリックIPアドレス＝Elastic IP Address
  - NAT GateWay: プライベートサブネット内でインターネットへの通信を行いたい場合に、パブリックサブネットへ設置する中継用ゲートウェイ。Internet GWを介した通信は双方向のため、インターネットからVPC内への通信を許容するのに対して、NAT GWを介した通信は単方向通信であり、プライベートサブネットからインターネットへ通信することはできるが、インターネットからプライベートサブネット内へは接続不可。
  - VPN GateWay: 仮想プライベートゲートウェイは、VPCとオンプレミス環境を接続。AWS側に設置。オンプレミス側にはCustomer GWの設置が必要。
  - VPC Peering: 独立した２つのVPCを接続し、プライベートアドレスを使って相互に通信。
  - VPCエンドポイント：VPCの中からAWSのマネージドサービス（EC2, RDS, S3）にアクセスするためのサービス。S3, DynamoDBのようにリージョン単位で提供されるリソース（＝リージョンサービス）は、VPCの外にあるAWSネットワーク内に構築されているため、アクセスするにはVPCから外部へ出るかたちに。S3などはデフォルトでインターネット経由のアクセスが可能なので、Internet GWやNAT GWの設定が実行されていれば通信できるが、インターネットを経由せずにアクセスを行いたい場合は、VPCエンドポイントの設置が必要。
    - VPCエンドポイントの種類：ゲートウェイ型とインターフェース型
    - ゲートウェイ型：リージョンサービスに対応。Internet GW, NAT GWだけでなく、ルートテーブルへの設定が必要。
    - インターフェース型：リージョンサービス以外に対応。VPCエンドポイントを使用したいリソースがあるサブネットに直接アタッチし、許可する接続をセキュリティグループで設定。

- VPCのアクセス制御
  - ルートテーブル
    - 指定されたCIDR表記のアドレスで通信をルーティングするルールセットの定義
    - VPCを作成すると同時にメインルートテーブルが自動作成される
    - VPCの各サブネットは何かしらのルートテーブルに関連づられる必要があり、サブネット：ルートテーブルの関係は 1~多:1

  - セキュリティグループ
    - アクセス許可するソースやプロトコル、ポートのルール定義を作成し、EC2やRDSなどのAWSリソースに関連付けることで、ファイアウォールとして動作
    - 受信と送信の両方をリソースレベルで制御できる＆リソースをグループ化して共通のセキュリティグループを関連づけることも可能
    - 通信の状態を記録して（ステートフルに）動作し、発生した通信に対する応答通信は自動的に許可される
  - ネットワークACL（Access Control List）
    - サブネットに関連づけられ、受信と送信の両方をサブネットレベルで制御できる
    - セキュリティグループよりも広範囲な制御・設定が可能
    - 通信の状態を記録せず（ステートレスに）動作するため、応答通信にも許可の設定が必要

- GuardDutyによる脅威の検知と通知
  - GuardDuty: VPCのフローログ（＝VPCのIPトラフィック情報をキャプチャ）などから不正なアクセスを検知するサービス

### Route 53
- VPCで構築したネットワーク内のリソースに、不特定多数のユーザーをアクセスさせるために必要なDNSサービス
- ホストゾーン
  - 権威DNSサーバとしての役割
    - = ゾーンの情報を保持し、各システム/サーバからの問い合わせに応じて管理するゾーンの情報を返却する
  - ユーザーはドメインごとに「ホストゾーン」と呼ばれるDNSレコードを管理するコンテナを作成し、AWS内のリソースとドメイン名の紐付けを行う
  - パブリックホストゾーン（＝インターネット上でどのようにトラフィックをルーティングするかを指定）とプライベートホストゾーン（＝VPC内でのルーティングを指定）がある
- ルーティングポリシー
  - クライアントとシステムの距離などに応じて最も高速なレスポンスを返せるよう応答の挙動を制御できる。用途に合わせて複数選定すべし。
- ヘルスチェック
  - 管理するIPアドレスをもつリソースが正しく動作してるかを監視。ルーティングポリシーと組み合わせて障害に強い設計にできる。（=DNSフェイルオーバー）
- Route 53 Resolver
  - オンプレミスやVPC内からのリソースの名前解決要求に応じて、Route 53のパブリック/プライベートホストゾーンへフォワードする

### Elastic Load Balancing
- Application Load Balancer, Classic Load Balancer, Network Load Balancerの３サービスの総称
- ロードバランシング：あるWebサービスが複数のWebサーバやアプリケーションサーバで構成されている場合に、リクエスト要求の負荷を分散させること

- ALB
  - L7(アプリケーション層)でのルーティングが可能　＝機能的な負荷分散
  - リバースプロキシ型：応答通信もロードバランサーを経由してクライアントへ届くタイプ
  - リスナーと呼ばれるコンポーネントを作成し、使用するプロトコルとポートを設定して、ルーティングルールを設定

## 第4章　コンピューティング関連のサービス
### EC2
- Elastic Computed Cloud
- Webサービスやバッチ処理といったアプリケーションの中核的な処理を実行する他、コンテナの実行、OSSの実行、開発時のテスト実行など幅広い用途で使用
- Amazon Machine Image: EC2上で仮想サーバとして動かすゲストOS。Amazon Linuxなど。



## 参考
- [AWS：ゼロから実践するAmazon Web Services。手を動かしながらインフラの基礎を習得](https://www.udemy.com/course/aws-and-infra/learn/lecture/14781780)




## インフラができるようになるメリット
- 自分でサービスを作れる
  - 自分自身でインフラを構築し、サービスをリリースできる
  - 開発する際のテスト環境を自分で作れるようになる
  - 高額なPaaSを利用する必要がなくなる
- 課題に対してシステム全体で対応できる
  - 障害があったときに、どこに問題があるか、切り分けられるように
  - 対応策を考えるときに、アプリケーションだけでなく、システム全体で対応できるように

## インフラ構築のやり方
1. サーバーの構成
   1. どのようなサーバーが必要かを考える
      1. サーバー：各サーバー用OSをインストールしたコンピュータ
   2. サーバーを設置する
   3. サーバーのOSをインストールし、各種設定を行う
   4. 必要なソフトウェアをインストールし、設定する
      1. 例）WebサーバならApache、データベースサーバならMySQL


2. ネットワークの構成
   1. 構築したサーバーをネットワークに接続する
      1. ネットワークで使用するIPアドレスの範囲を決める
      2. サーバーにIPアドレスを割り当てる
      3. ドメイン名とIPアドレスの対応を割り当てる

## AWSとは
- Amazon社が提供する世界最大級のクラウドサービス
  - クラウド上でサーバやネットワークを構築するサービス
- サービスが豊富＆高負荷に耐えられる信頼性の高いシステムを少ない手間（フルマネージド）で運用できる
  - EC2：仮想サーバ
  - RDS：仮想DB
- リソースが柔軟
  - 必要なときに必要な分だけ調達できる
- 従量課金
  - 費用対効果に優れている

## インフラとは
- サーバーやネットワークのこと
  - サーバー：クライアントに対してサービスを提供するコンピュータ
  - ネットワーク：複数のコンピュータをつないで、データを送受信できるようにするもの
- システムやサービスの基盤となる設備
  
## クラウドとは
- クラウド（コラウドコンピューティング）とは、ネットワークを利用していコンピューターリソースを利用する形態のこと
- オンプレミス：インフラを自前で用意し、自社で所有管理
  - クラウド誕生前のデフォルト
  - 利点：自由度が高いこと
  - 欠点：初期コストがかかり、調達期間が必要で、サーバーの増減がしにくい
- クラウド：インフラをネットワーク経由で使用・管理する
  - 利点：初期コストが少なく、すぐに始められ、サーバーの増減が自由
  - 欠点：費用の予測がつきづらい、クラウド全体で障害が起きると対応のしようがない

## AWSの初期設定
- CloudWatchで料金アラートを設定
- IAMで作業用ユーザーを作成し、以降IAMユーザで作業（rootユーザーとは別にする）
- CloudTrailで操作ログを記録（保存期間をデフォルトの90日から永久的保存に変更）
- 管理画面＝マネジメントコンソール

## ネットワークを構築
- VPC→EC2→アプリケーションのインストール、の順
- パブリックサブネット：インターネット上に公開されているネットワーク
  - WordPress on Apache
- プライベートサブネット：インターネット上に公開されていないネットワーク
  - MySQL

### リージョン
- リージョン：AWSの各サービスが提供されている地域のこと
  - リージョンによって使えるサービスが異なる
  - 最新機能はアメリカのリージョンで利用可能
  - 日本でサービスを提供する場合は、応答時間の関係で日本のリージョンを選択すると◎
- アベイラビリティゾーン：独立したデータセンターのこと
  - 各リージョンに複数のアベイラビリティゾーンがあり、災害などで停止しないようになっている
  - 東京なら、ap-northeast-1a,c,dの３つのアベイラビリティゾーンがある

### VPC
- VPC: Virtual Private Cloud。AWS上に仮想ネットワークを作成できるサービス
- VPCを作成するリージョンを選択し、VPC内で、アベイラビリティゾーン同士のネットワークを構築
- サブネット：VPCを細かく区切ったネットワーク（インターネット上に公開するネットワークと非公開にするネットワークに区切る）。１つのアベイラビリティゾーンあたり複数のサブネットを作る＝冗長性を高める◎

### IPアドレス
- 例）10.0.0.0/16, 10.0.20.0/24
- VPC、サブネットのIPアドレスの範囲を決める
- IPアドレス：ネットワーク上の機器を識別するためのインターネット上の住所
- パブリックIPアドレス：インターネットに接続する際に使用する。重複NG。プロバイダーやサーバー事業者、AWSから貸し出される。
- プライベートIPアドレス；インターネットで使用されないIPアドレス。重複を気にせず自由に使える。
- IPアドレスはネットワーク部とホスト部に区分けすることで、範囲を表記する
  - CIDR表記：IPアドレスの後ろに「/」を書き、その後ろにネットワーク部が先頭から何ビット目までなのかを記載
    - 例）192.168.128.0/24
  - サブネットマスク表記：IPアドレスの後ろに「/」を書き、ネットワーク部を表すビットと同じ部分を1に、ホスト部を表すビットと同じ部分を０にする
    - 例）192.168.128.0/255.255.255.0

### ルーティング
- ルーター：IPアドレスの行き先を管理
  - サブネットやインターネットゲートウェイ（＝VPCとインターネットを繋ぐ仮想のルーター）間にはルーターが動いている
- ルーティング：ネットワークとネットワークがIPアドレスを通じて接続できるようにすること
- ルートテーブル：ルーティングの対応表
  - 「宛先のIPアドレス」と「次のルーター（＝ターゲット in AWS）」という書式で設定
  - local = 自身のネットワーク
  - 0.0.0.0/0 = デフォルトルート：ルートテーブルに登録されているどのアドレスにも一致しない場合の経路
  - サブネットごとに設定できる

## ネットワークの構築 実践
1. VPCを作成
2. サブネットを作成
   1. 耐障害性があがる
   2. セキュリティ強化（インターネットからの隔離）
3. ルーティングを設定
   1. インターネットゲートウェイを作成し、VPCにアタッチ
   2. ルートテーブルを作成し、パブリックサブネットに紐付け
      1. デフォルトルートをインターネットゲートウェイに割り当てたルートテーブルをパブリックサブネットに紐づけることで、パブリックサブネットからインターネットに接続できるようにする

### 設計のポイント
#### VPCの設計のポイント
- プライベートIPアドレス範囲から指定
  - VPCでは仮想のプライベートネットワーク空間を作成するので、プライベートIPアドレスの使用が推奨
- 作成後は変更できないので、大きめに設定
  - 大きさは/28から/16。/16が推奨
- オンプレミスや他VPCのレンジと重複しないように気をつける（併用して使用する場合）
  - 相互接続する可能性がある場合は、重複しないように設計

#### VPCを分割するか？
- 異なるシステムの場合はアカウントを分ける
- 本番環境、ステージング環境など環境が違う場合、同一アカウントでVPC＆リージョンを分けるとよい

#### サブネットの設計のポイント
- 将来的に必要なIPアドレス数を見積もって設定
  - /24が標準的
- サブネットの分割は、ルーティングとアベイラビリティーゾーンを基準に行う
  - サブネットに割り当てられるルートテーブルは１つ
  - インターネットアクセスの有無、拠点アクセスの有無などのルーティングポリシーに応じて分割
  - 高可用性（耐障害性）のために、２つ以上のアベイラビリティゾーンを使用する

## Webサーバーを構築　実践
1. EC2（AWSが提供する仮想サーバー）を設置
   1. ＠パブリックサブネット
2. EC2にSSHでログイン（Apacheなどのソフトウェアをインストールするため）
3. ファイアウォールを設定
4. Elastic IPアドレスでIPアドレスを固定

### EC2インスタンス
- EC2: Elastic Compute Cloudの略。AWSクラウド上の仮想サーバー
- インスタンス：EC2から立てられたサーバー
- 特徴
  - 秒単位から従量課金可能
  - サーバーの増減・スペック変更も数分で可能
  - OSより上のレイヤについては自由に設定できる
- 作成手順
  - AMIの選択
  - インスタンスタイプの選択
  - ストレージの追加
  - セキュリティグループの設定
  - SSHキーペアの設定

### AMI
- AMI: Amazon Machine Image。インスタンス起動に必要な情報が入った、OSのイメージ。サーバーのテンプレートのようなもの。

### インスタンスタイプ
- サーバーのスペックを定義したもの
- インスタンスタイプによってCPU、メモリ、ストレージ、ネットワーク帯域が異なる
- 表記構成：インスタンスファミリー(ex. m)・インスタンス世代(ex. 5)・インスタンスサイズ(ex. xlarge)

### ストレージ
- サーバーにくっつけるデータの保存場所。EBS or インスタンスストア。
- EBS：Elastic Block Store。他のインスタンスに付け替え可能。EC2インスタンスを停止してもEBSは保持可能。Snapshotを取得しS3（クラウド上のデータ保存場所）に保存可能→長期保存。OSやDBなどの永続性と耐久性が必要なデータを置く。（実際によく使われるのはこっち）
- インスタンスストア：インスタンス専用の一時的なストレージ。EC2インスタンスを停止するとクリアされる。一時ファイル、キャッシュなど失われても問題ないデータを置く。

### EC2インスタンスの設定
- 自動割り当てパブリックIP  