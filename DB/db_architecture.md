## DB設計
- 多対多の関連を表現するのに、中間テーブルをおく
- 実際の開発では、UIを最初に設計してから、その**インターフェースと機能を実現するシステムのDBを設計する**のが良い

### DB設計（論理設計）手順
1. エンティティの抽出
   1. エンティティ：ある共通項を持ったデータの集合体のこと（＝テーブル）
   2. 最初は大きいものから抽出していく（細部の情報はメモしておく）
   3. エンティティ同士でどんな出来事・状態変化が起こるか？を考えて必要なエンティティを洗い出す（ex. 車と客の間→注文）
      1. コツ① システムがどう使われれるのか、シミュレーションする
      2. コツ② 要件の不明点を丁寧に潰していくこと
   4. **これは何をするためのシステムなのか？を考え、中心となるエンティティを抽出。５W１Hを考える。**
2. エンティティの定義
   1. エンティティにどんな属性（＝カラム）が必要か洗い出す
      1. さまざまなユースケースのシミュレーションが大事
      2. 画面・帳票にどんな内容が表示されるかを考えるのも◎
      3. カラム名のシノニム（同義異名）・ホモニム（同名異義）に気をつける
   2. **インターフェース中の項目（＋仕様書の項目）をエンティティの属性として入れていく**
3. 正規化（←→JOIN）...**主キーと外部キーの設定**
   1. 正規化：各テーブルに持たせるデータの種類を最適化。あるテーブルが持っている情報のうち、特定の情報のみを別テーブルに切り出す。データの冗長性（ムダ・重複）をなくす。
   2. 正規化の目的：INSERT, UPDATE, DELETEなどのデータ更新時にデータの不整合が起きないように
   3. 具体的に…「他のデータの状態に依存せず、独立して存在してほしいデータ」を別のテーブルに移す
   4. 正規化してはいけない場合：「ある時点のデータを、そのまま残しておく必要がある」ケース（商品名や価格など変動する可能性があるものの履歴を残しておく必要があるから）
   5. 正規化＝RDBにおけるエンティティの整理＝テーブルを正規形に整えること
      1. 正規形：DBにおいて保持するデータの重複が排除されたデータ形式
      2. 第1正規形：１つのフィールドには１つの値しか含まない（複数含んでしまうと主キーが成立しない）
      3. 第2正規形：部分関数従属が解消され、完全関数従属のみのテーブルになっている形。（部分関数従属：複数の主キーの一部の列に対して従属する関係がある状態。例：会社IDと社員IDが主キーなのに会社名がカラムにある）
      4. 第3正規形：推移的関数従属が解消されている形。（推移的関数従属：２段階の関数従属がある。例：{会社ID,社員ID} -> {部署ID} -> {部署名}。社員がいない部署をテーブルに表現できない）
   6. 正規化を行う上で重要な概念…"関数従属性"
      1. y=f(x)、のようにxの値を１つ決めればyの値が１つに決まる関係性。「yはxに従属する」「 {x} -> {y} 」
      2. 正規化とは「テーブルの全ての列が関数従属性を満たすように整理していくこと」「 {主キー} -> {カラム} が全てのカラムで成立」
4. ER図の作成
   1. エンティティ（＝テーブル）間の関係を視覚的にわかりやすく作図
   2. リレーションの種類
      1. １対多（1:N）:正規化された場合ほとんどのリレーションはこれ
      2. １対１（1:1）：論理設計が適切であれば基本的に登場しない
   3. SchemaSpyなどのER図自動生成ツールを用いたり
   4. IE表記法・別名「鳥の足表記法」
      1. エンティティ内：上半分に主キー属性、下半分に非キー属性
      2. リレーション：縦棒＝1、○=０以上、鳥足＝多

### テーブルとは
- テーブルの構成要素
  - 行（レコード）と列（カラム）
  - キー：特定のデータを引き出すための鍵となる列。主キー、外部キー
    - 主キー：primary key。その値を指定すれば必ず1行のレコードを指定できるような列（の組み合わせ）。only one
    - 外部キー：foreign key。２つのテーブル間の列同士の関連性を設定。参照整合性制約・外部キー制約（外部キーの参照元が存在しないものは設定できない）を課す。
  - 制約
    - NOT NULL制約：フィールドにデータが入っていない状態を禁止（NULLはSQLエラーの原因になりやすいから排除するべし）


### DBの本質
「データを安全に壊れないように保存してくれて、高速に取り出せるツールである」ということ

### 論理設計の本質
- ビジネスルールを、データ構造（テーブル）として表現する 

### 3層スキーマ（枠組み）
- 外部スキーマ（ユーザーから見たDB、ビュー = SELECT文の出力結果）
  - 利用者に最も近い
- 概念スキーマ（開発者から見たDB、テーブル）
  - 外部スキーマと内部スキーマの間で処理
  - → 外部スキーマと内部スキーマが直接的なつながりを持たない
  - 外部スキーマ＆内部スキーマだけでなぜだめか？  
    - データ独立性を確保するのに、概念スキーマは必要
    - データ独立性：外部スキーマを変更しても、内部スキーマを変更不要vice versa
- 内部スキーマ（DBMSから見たDB、データの物理的配置）
  - 概念-内部：ストレージやディスクに入っているデータファイルをテーブルに変換

### 論理設計と物理設計
- 論理設計（概念スキーマの設計）：データを管理するためのデータモデルの設計
- 物理設計（内部スキーマの設計）：DDLによる実装やストレージの構成などの設計
  - DDL:SQLでいうと、create文やdrop文

### SQLの３つの機能
- データ操作 (Data Manipulation)：テーブルのデータの操作。CRUD。SELECT, INSERT, UPDATE, DELETE文などのDMLによって行われる。
- データ定義 (Data Definition)：テーブルのデータ構造の定義や削除。DDLによって行われる。
- データ制御 (Data Control)：データベースへのアクセス制御など。DCLによって行われる。

### DDL(Data Definition Language)
- CREATE：DBやテーブルを作成
- DROP：DBやテーブルを削除
- ALTER：データベースやテーブルの構成を変更
- 論理設計で定義したテーブルは、DDLで定義することによってRDBMS上で扱えるようになる

### データ型
- INTEGER：整数
- CHAR：固定長文字列。文字数が固定される。（最大文字数未満の場合は末尾に空白が入る）。電話番号など形式がある程度固定されているものに使う。
- VARCHAR：可変長文字列。CHAR型と同様に最大文字数を指定するが、文字数はそのまま。
- DATE：年月日

### 条件式
- 比較演算子 `a<>b` : aとbは等しくない

## 参考
- [データベーステーブル設計の基礎の基礎～エンティティの抽出・定義から正規化まで](https://eh-career.com/engineerhub/entry/2018/06/22/110000/?PK=18C84C)
- [はじめてのDB設計-Udemy](https://www.udemy.com/share/102r1I3@7UhGEPSnMG4DGSmFeK7pxNptqdSpcPJ3E2VXfBd3zQqkBMkDYOGUYmrXygaEoZgDxg==/)
- [3時間で学ぶSQL-Udemy](https://www.udemy.com/share/102p3S3@uo34QJE26jZ0ROIfIKR5Itw2V892EKNwyj9gXEIqveZRWG-tamx3xkrr5tN62t1o7Q==/)
- [楽々ERDレッスン 第1回：「お持ち帰りご注文用紙」編](https://codezine.jp/article/detail/154)
- [レシートで学ぶデータモデリング入門](https://future-architect.github.io/articles/20200616/)